{% extends "base.html" %}
{% block title %}La mia bacheca{% endblock %}

{% block content %}
<div class="container mt-4">
  <div class="row g-4">
    <!-- COLONNA PRINCIPALE -->
    <div class="col-md-8">
      <h2 class="mb-4">La mia bacheca</h2>

  

      {% if posts and posts|length > 0 %}
        {% for post in posts %}
          <div class="card mb-3 shadow-sm">
            <div class="card-body">
              <div class="d-flex align-items-center mb-2">
                <strong class="me-2">{{ owner.nome if owner else 'Io' }}</strong>
                <small class="text-muted">{{ post.created_at.strftime('%d/%m/%Y %H:%M') }}</small>
              </div>

              
              {% if post.moderation_status and post.moderation_status != 'approved' %}
                <div class="mb-2">
                  {% if post.moderation_status == 'pending' %}
                    <span class="badge text-bg-warning">In revisione</span>
                    <small class="text-muted ms-2">Questo post è visibile solo a te finché non viene approvato.</small>
                  {% elif post.moderation_status == 'rejected' %}
                    <span class="badge text-bg-danger">Rifiutato</span>
                    <small class="text-muted ms-2">Non è visibile pubblicamente.</small>
                  {% endif %}
                </div>
              {% endif %}

              {% if post.content %}
                <p class="mb-2">{{ post.content }}</p>
              {% endif %}

              {# IMMAGINE: se locale (uploads/...), passa da static; se http/https usa diretto #}
              {% if post.image_url %}
                {% set _img = post.image_url %}
                {% if _img.startswith('http') %}
                  <img src="{{ _img }}" class="img-fluid rounded mb-2" alt="immagine post">
                {% else %}
                  <img src="{{ url_for('static', filename=_img) }}" class="img-fluid rounded mb-2" alt="immagine post">
                {% endif %}
              {% endif %}

              {# VIDEO: se locale passa da static, altrimenti diretto #}
              {% if post.video_url %}
                {% set _vid = post.video_url %}
                <video class="mb-2" controls style="max-width:100%; border-radius:8px;">
                  <source src="{% if _vid.startswith('http') %}{{ _vid }}{% else %}{{ url_for('static', filename=_vid) }}{% endif %}">
                </video>
              {% endif %}

              {# Azioni (like/modifica/elimina). Nel tuo partial controlli già owner/permessi #}
              {% include "_post_actions.html" %}
            </div>
          </div>
        {% endfor %}
      {% else %}
        <p class="text-muted">Nessun post presente.</p>
      {% endif %}
    </div>

    <!-- COLONNA IMMAGINI -->
    <div class="col-md-4">
      <h5 class="mb-3">Immagini</h5>
      <div class="sidebar-images">
        <img src="{{ url_for('static', filename='uploads/img1.png') }}" class="img-fluid mb-3 rounded shadow-sm" alt="img1">
        <img src="{{ url_for('static', filename='uploads/img2.png') }}" class="img-fluid mb-3 rounded shadow-sm" alt="img2">
        <img src="{{ url_for('static', filename='uploads/img3.png') }}" class="img-fluid mb-3 rounded shadow-sm" alt="img3">
        <img src="{{ url_for('static', filename='uploads/img4.png') }}" class="img-fluid mb-3 rounded shadow-sm" alt="img4">
        <img src="{{ url_for('static', filename='uploads/img5.png') }}" class="img-fluid mb-3 rounded shadow-sm" alt="img5">
        <img src="{{ url_for('static', filename='uploads/img6.jpeg') }}" class="img-fluid mb-3 rounded shadow-sm" alt="img6">
      </div>
    </div>
  </div>
</div>

<style>
  .sidebar-images { max-height: 120vh; overflow-y: auto; }
  .sidebar-images img { object-fit: cover; }
</style>
{% endblock %}
